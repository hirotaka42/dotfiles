<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webç‰ˆIMEè¾æ›¸ãƒ„ãƒ¼ãƒ« - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        h1 {
            color: #2c3e50;
        }

        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid;
        }

        .test-pass {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .test-fail {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .test-error {
            font-family: monospace;
            font-size: 12px;
            margin-top: 5px;
            padding: 5px;
            background: #fff;
            border-radius: 3px;
        }

        .summary {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }

        .summary-pass {
            background: #d4edda;
            color: #155724;
        }

        .summary-fail {
            background: #f8d7da;
            color: #721c24;
        }

        button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <h1>ğŸ“š Webç‰ˆIMEè¾æ›¸ãƒ„ãƒ¼ãƒ« - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ</h1>

    <div class="test-container">
        <button onclick="runAllTests()">ğŸ§ª å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
    </div>

    <div class="test-container" id="test-results">
        <h3>ãƒ†ã‚¹ãƒˆçµæœ</h3>
        <p>ã€Œå…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</p>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿
        const testData = {
            "è¾æ›¸æƒ…å ±": {
                "åå‰": "ãƒ†ã‚¹ãƒˆç”¨è¾æ›¸",
                "èª¬æ˜": "ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”¨",
                "æ›´æ–°æ—¥": "2025-01-01"
            },
            "ã‚«ãƒ†ã‚´ãƒª": {
                "è¨˜å·": {
                    "èª¬æ˜": "ãƒ†ã‚¹ãƒˆç”¨è¨˜å·",
                    "æœ‰åŠ¹": true,
                    "å˜èªãƒªã‚¹ãƒˆ": [
                        {
                            "èª­ã¿": "ã¿ãã‚„",
                            "å˜èª": "â†’",
                            "å“è©": "è¨˜å·",
                            "èª¬æ˜": "å³çŸ¢å°",
                            "ã‚¿ã‚°": ["çŸ¢å°", "è¨˜å·"]
                        },
                        {
                            "èª­ã¿": "ã¾ã‚‹",
                            "å˜èª": "â—‹",
                            "å“è©": "è¨˜å·",
                            "èª¬æ˜": "ä¸¸å°",
                            "ã‚¿ã‚°": ["è¨˜å·"]
                        }
                    ]
                },
                "äººå": {
                    "èª¬æ˜": "ãƒ†ã‚¹ãƒˆç”¨äººå",
                    "æœ‰åŠ¹": true,
                    "å˜èªãƒªã‚¹ãƒˆ": [
                        {
                            "èª­ã¿": "ãŸãªã‹",
                            "å˜èª": "ç”°ä¸­",
                            "å“è©": "äººå",
                            "èª¬æ˜": "äººåãƒ†ã‚¹ãƒˆ",
                            "ã‚¿ã‚°": ["äººå"]
                        }
                    ]
                }
            }
        };

        // app.jsã‹ã‚‰å¿…è¦ãªé–¢æ•°ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆç°¡ç•¥ç‰ˆï¼‰
        function escapeCSVField(field) {
            if (field == null) return '';
            const str = String(field);
            return str.replace(/"/g, '""');
        }

        function mapPOSForWindows(pos) {
            const windowsPOSMap = {
                'è¨˜å·': 'çŸ­ç¸®ã‚ˆã¿',
                'åè©': 'åè©',
                'å‹•è©': 'åè©',
                'å½¢å®¹è©': 'åè©',
                'å‰¯è©': 'åè©',
                'äººå': 'äººå',
                'åœ°å': 'åœ°å',
                'å›ºæœ‰åè©': 'åè©',
                'çŸ­ç¸®ã‚ˆã¿': 'çŸ­ç¸®ã‚ˆã¿',
                'é¡”æ–‡å­—': 'é¡”æ–‡å­—',
                'ã‚µå¤‰åè©': 'ã‚µå¤‰åè©'
            };
            return windowsPOSMap[pos] || 'åè©';
        }

        // ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
        class TestRunner {
            constructor() {
                this.tests = [];
                this.results = [];
            }

            test(name, fn) {
                this.tests.push({ name, fn });
            }

            async run() {
                this.results = [];

                for (const test of this.tests) {
                    try {
                        await test.fn();
                        this.results.push({ name: test.name, passed: true });
                    } catch (error) {
                        this.results.push({
                            name: test.name,
                            passed: false,
                            error: error.message
                        });
                    }
                }

                return this.results;
            }

            displayResults() {
                const container = document.getElementById('test-results');
                const passed = this.results.filter(r => r.passed).length;
                const failed = this.results.filter(r => !r.passed).length;
                const total = this.results.length;

                let html = '<h3>ãƒ†ã‚¹ãƒˆçµæœ</h3>';

                this.results.forEach(result => {
                    const className = result.passed ? 'test-pass' : 'test-fail';
                    const icon = result.passed ? 'âœ…' : 'âŒ';

                    html += `
                        <div class="test-result ${className}">
                            <div class="test-name">${icon} ${result.name}</div>
                            ${result.error ? `<div class="test-error">ã‚¨ãƒ©ãƒ¼: ${result.error}</div>` : ''}
                        </div>
                    `;
                });

                const summaryClass = failed === 0 ? 'summary-pass' : 'summary-fail';
                html += `
                    <div class="summary ${summaryClass}">
                        åˆè¨ˆ: ${total}ä»¶ | æˆåŠŸ: ${passed}ä»¶ | å¤±æ•—: ${failed}ä»¶
                    </div>
                `;

                container.innerHTML = html;
            }
        }

        // ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
        function assert(condition, message) {
            if (!condition) {
                throw new Error(message || 'ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼');
            }
        }

        function assertEqual(actual, expected, message) {
            if (actual !== expected) {
                throw new Error(message || `æœŸå¾…å€¤: ${expected}, å®Ÿéš›: ${actual}`);
            }
        }

        function assertIncludes(array, value, message) {
            if (!array.includes(value)) {
                throw new Error(message || `é…åˆ—ã« ${value} ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“`);
            }
        }

        // ãƒ†ã‚¹ãƒˆå®šç¾©
        function defineTests(runner) {
            runner.test('CSVãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— - é€šå¸¸ã®æ–‡å­—åˆ—', () => {
                const result = escapeCSVField('ãƒ†ã‚¹ãƒˆ');
                assertEqual(result, 'ãƒ†ã‚¹ãƒˆ');
            });

            runner.test('CSVãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— - ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ', () => {
                const result = escapeCSVField('test "quoted"');
                assertEqual(result, 'test ""quoted""');
            });

            runner.test('CSVãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— - null', () => {
                const result = escapeCSVField(null);
                assertEqual(result, '');
            });

            runner.test('Windowså“è©ãƒãƒƒãƒ”ãƒ³ã‚° - è¨˜å·', () => {
                const result = mapPOSForWindows('è¨˜å·');
                assertEqual(result, 'çŸ­ç¸®ã‚ˆã¿', 'è¨˜å·ã¯çŸ­ç¸®ã‚ˆã¿ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ã¹ã');
            });

            runner.test('Windowså“è©ãƒãƒƒãƒ”ãƒ³ã‚° - åè©', () => {
                const result = mapPOSForWindows('åè©');
                assertEqual(result, 'åè©');
            });

            runner.test('Windowså“è©ãƒãƒƒãƒ”ãƒ³ã‚° - äººå', () => {
                const result = mapPOSForWindows('äººå');
                assertEqual(result, 'äººå');
            });

            runner.test('Windowså“è©ãƒãƒƒãƒ”ãƒ³ã‚° - å‹•è©', () => {
                const result = mapPOSForWindows('å‹•è©');
                assertEqual(result, 'åè©', 'å‹•è©ã¯åè©ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ã¹ã');
            });

            runner.test('Windowså“è©ãƒãƒƒãƒ”ãƒ³ã‚° - æœªå®šç¾©å“è©', () => {
                const result = mapPOSForWindows('æœªå®šç¾©å“è©');
                assertEqual(result, 'åè©', 'æœªå®šç¾©å“è©ã¯åè©ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ã¹ã');
            });

            runner.test('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ - ã‚«ãƒ†ã‚´ãƒªæ•°', () => {
                const categories = Object.keys(testData.ã‚«ãƒ†ã‚´ãƒª);
                assertEqual(categories.length, 2, 'ã‚«ãƒ†ã‚´ãƒªã¯2ã¤ã‚ã‚‹ã¹ã');
            });

            runner.test('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ - è¨˜å·ã‚«ãƒ†ã‚´ãƒªã®å˜èªæ•°', () => {
                const words = testData.ã‚«ãƒ†ã‚´ãƒª['è¨˜å·'].å˜èªãƒªã‚¹ãƒˆ;
                assertEqual(words.length, 2, 'è¨˜å·ã‚«ãƒ†ã‚´ãƒªã«ã¯2ã¤ã®å˜èªãŒã‚ã‚‹ã¹ã');
            });

            runner.test('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ - äººåã‚«ãƒ†ã‚´ãƒªã®å˜èªæ•°', () => {
                const words = testData.ã‚«ãƒ†ã‚´ãƒª['äººå'].å˜èªãƒªã‚¹ãƒˆ;
                assertEqual(words.length, 1, 'äººåã‚«ãƒ†ã‚´ãƒªã«ã¯1ã¤ã®å˜èªãŒã‚ã‚‹ã¹ã');
            });

            runner.test('CSVå‡ºåŠ›å½¢å¼ - ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ', () => {
                const header = '"èª­ã¿","å˜èª","å“è©","èª¬æ˜","ã‚¿ã‚°","ã‚«ãƒ†ã‚´ãƒª"';
                assert(header.includes('èª­ã¿'), 'ãƒ˜ãƒƒãƒ€ãƒ¼ã«èª­ã¿ãŒå«ã¾ã‚Œã‚‹ã¹ã');
                assert(header.includes('å˜èª'), 'ãƒ˜ãƒƒãƒ€ãƒ¼ã«å˜èªãŒå«ã¾ã‚Œã‚‹ã¹ã');
                assert(header.includes('å“è©'), 'ãƒ˜ãƒƒãƒ€ãƒ¼ã«å“è©ãŒå«ã¾ã‚Œã‚‹ã¹ã');
            });

            runner.test('XMLç‰¹æ®Šæ–‡å­—ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—', () => {
                const testStr = '<test> & "quote"';
                const escaped = testStr
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;');

                assertEqual(escaped, '&lt;test&gt; &amp; &quot;quote&quot;');
            });

            runner.test('UTF-16LEå¤‰æ› - BOMç¢ºèª', () => {
                const content = 'test';
                const byteArray = new Uint8Array(content.length * 2 + 2);
                byteArray[0] = 0xFF;
                byteArray[1] = 0xFE;

                assertEqual(byteArray[0], 0xFF, 'BOMä¸‹ä½ãƒã‚¤ãƒˆãŒæ­£ã—ããªã„');
                assertEqual(byteArray[1], 0xFE, 'BOMä¸Šä½ãƒã‚¤ãƒˆãŒæ­£ã—ããªã„');
            });

            runner.test('UTF-16LEå¤‰æ› - æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰', () => {
                const char = 'A'; // 0x0041
                const charCode = char.charCodeAt(0);
                const byteArray = new Uint8Array(4);

                byteArray[0] = 0xFF;
                byteArray[1] = 0xFE;
                byteArray[2] = charCode & 0xFF;
                byteArray[3] = (charCode >> 8) & 0xFF;

                assertEqual(byteArray[2], 0x41, 'ä¸‹ä½ãƒã‚¤ãƒˆãŒæ­£ã—ããªã„');
                assertEqual(byteArray[3], 0x00, 'ä¸Šä½ãƒã‚¤ãƒˆãŒæ­£ã—ããªã„');
            });

            runner.test('å“è©ã®ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯', () => {
                testData.ã‚«ãƒ†ã‚´ãƒª['è¨˜å·'].å˜èªãƒªã‚¹ãƒˆ.forEach(word => {
                    const mappedPOS = mapPOSForWindows(word.å“è©);
                    assert(mappedPOS, 'å“è©ãŒãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ã¹ã');
                });
            });

            runner.test('ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° - å˜ä¸€ã‚«ãƒ†ã‚´ãƒª', () => {
                const selectedCategories = ['è¨˜å·'];
                const words = [];

                selectedCategories.forEach(cat => {
                    if (testData.ã‚«ãƒ†ã‚´ãƒª[cat]) {
                        words.push(...testData.ã‚«ãƒ†ã‚´ãƒª[cat].å˜èªãƒªã‚¹ãƒˆ);
                    }
                });

                assertEqual(words.length, 2, 'è¨˜å·ã‚«ãƒ†ã‚´ãƒªã®å˜èªã¯2ã¤');
            });

            runner.test('ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° - è¤‡æ•°ã‚«ãƒ†ã‚´ãƒª', () => {
                const selectedCategories = ['è¨˜å·', 'äººå'];
                const words = [];

                selectedCategories.forEach(cat => {
                    if (testData.ã‚«ãƒ†ã‚´ãƒª[cat]) {
                        words.push(...testData.ã‚«ãƒ†ã‚´ãƒª[cat].å˜èªãƒªã‚¹ãƒˆ);
                    }
                });

                assertEqual(words.length, 3, 'è¨˜å·ã¨äººåã‚«ãƒ†ã‚´ãƒªã®å˜èªã¯3ã¤');
            });
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runAllTests() {
            const runner = new TestRunner();
            defineTests(runner);

            await runner.run();
            runner.displayResults();
        }
    </script>
</body>
</html>
